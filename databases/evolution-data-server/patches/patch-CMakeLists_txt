$OpenBSD: patch-CMakeLists_txt,v 1.2 2017/04/19 07:42:40 ajacoutot Exp $

DB_LOAD: https://bugzilla.gnome.org/show_bug.cgi?id=78146

--- CMakeLists.txt.orig	Mon Apr 10 09:40:17 2017
+++ CMakeLists.txt	Mon Apr 17 11:29:59 2017
@@ -305,7 +305,7 @@ endif(NOT PYTHON)
 # db_load checking, it's optional
 # ******************************
 
-find_program(DB_LOAD NAMES db_load db5_load db_load-5)
+find_program(DB_LOAD NAMES db_load db5_load db_load-5 db4_load)
 if(DB_LOAD)
 	set(HAVE_DB_LOAD ON)
 else(DB_LOAD)
@@ -502,14 +502,15 @@ endif(WITH_LIBDB)
 # iconv checking
 # ******************************
 
-set(CMAKE_REQUIRED_LIBRARIES "-liconv")
+set(CMAKE_REQUIRED_FLAGS "-I${LOCALBASE}/include")
+set(CMAKE_REQUIRED_LIBRARIES "-L${LOCALBASE}/lib" -liconv)
 CHECK_C_SOURCE_COMPILES("#include <iconv.h>
 			#include <stdlib.h>
 			int main(void) { iconv_t cd; cd = iconv_open (\"UTF-8\", \"ISO-8859-1\"); return 0; }" HAVE_LIBICONV)
 unset(CMAKE_REQUIRED_LIBRARIES)
 
 if(HAVE_LIBICONV)
-	set(ICONV_LIBS "-liconv")
+	set(ICONV_LIBS "-L${LOCALBASE}/lib -liconv")
 	set(HAVE_ICONV ON)
 else(HAVE_LIBICONV)
 	set(ICONV_LIBS "")
