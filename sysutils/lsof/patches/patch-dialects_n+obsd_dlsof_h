$OpenBSD: patch-dialects_n+obsd_dlsof_h,v 1.9 2016/09/25 16:46:01 sthen Exp $
1. Unbreak build.
2. Add support for tmpfs.
--- dialects/n+obsd/dlsof.h.orig	Wed Mar 29 07:54:15 2006
+++ dialects/n+obsd/dlsof.h	Fri Sep 23 09:12:15 2016
@@ -52,8 +52,12 @@
 # endif	/* defined(HASGETBOOTFILE) */
 
 #include <sys/filedesc.h>
+#include <sys/tree.h>
+#include <sys/queue.h>
 #include <sys/mbuf.h>
-  
+ 
+#define RBT_PROTOTYPE(n, t, e, c) /* nop */
+ 
 # if	defined(HAS_LWP_H)
 #include <sys/lwp.h>
 # endif	/* defined(HAS_LWP_H) */
@@ -150,6 +154,7 @@ struct uio;	/* dummy for function prototype in <sys/bu
 struct nameidata;	/* to satisfy a function prototype in msdosfsmount.h */
 #include <msdosfs/msdosfsmount.h>
 #undef	_KERNEL
+#include <sys/lock.h>
 #include <msdosfs/direntry.h>
 #include <msdosfs/denode.h>
 # endif	/* defined(HASMSDOSFS) */
@@ -416,8 +421,11 @@ struct vop_advlock_args;
 
 # if	defined(UVM)
 #  if	defined(OPENBSDV)
-#define	_UVM_UVM_FAULT_I_H_	1		/* avoid OpenBSD's
-						/* <uvm/uvm_fault_i.h */
+/* XXX until uvm gets cleaned up */
+#include <sys/mutex.h>
+typedef int boolean_t;
+
+#define	_UVM_UVM_FAULT_I_H_	1	/* avoid OpenBSD's <uvm/uvm_fault_i.h> */
 #  endif	/* defined(OPENBSDV) */
 #define	FALSE	0
 #define	TRUE	1
@@ -580,5 +588,10 @@ struct sfile {
 #define	NCACHE_NODEID	nc_vpid		/* node ID in NCACHE */
 #  endif	/* defined(HASNCVPID) */
 # endif  /* defined(HASNCACHE) */
+
+#define	_KERNEL
+#include <sys/namei.h>
+#include <tmpfs/tmpfs.h>
+#undef	_KERNEL
 
 #endif	/* NETBSD_LSOF_H */
