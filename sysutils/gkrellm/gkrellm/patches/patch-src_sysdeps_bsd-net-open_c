$OpenBSD: patch-src_sysdeps_bsd-net-open_c,v 1.7 2017/04/23 13:48:29 sthen Exp $
--- src/sysdeps/bsd-net-open.c.orig	Wed Feb  1 23:48:00 2017
+++ src/sysdeps/bsd-net-open.c	Wed Feb  1 23:50:44 2017
@@ -67,7 +67,7 @@ gkrellm_sys_inet_read_tcp_data(void)
    ActiveTCP tcp;
    gint	tcp_status;
    struct inpcbtable table;
-   struct inpcb inpcb, *head, *next;
+   struct inpcb inpcb, *next;
    struct tcpcb tcpcb;
    static struct nlist nl[] = {
 #define X_TCBTABLE    0
@@ -84,10 +84,8 @@ gkrellm_sys_inet_read_tcp_data(void)
 		sizeof(struct inpcbtable)) != sizeof(struct inpcbtable))
       return;
 
-	head = (struct inpcb *)
-		&((struct inpcbtable *)nl[X_TCBTABLE].n_value)->inpt_queue.cqh_first;
-   next = (struct inpcb *)table.inpt_queue.cqh_first;
-   while(next != NULL && next != head) {
+   next = TAILQ_FIRST(&table.inpt_queue);
+   while(next != NULL) {
       
       if (kvm_read(kvmd, (u_long)next,
 		   (char *)&inpcb, sizeof(inpcb)) == sizeof(inpcb) &&
@@ -103,7 +101,7 @@ gkrellm_sys_inet_read_tcp_data(void)
 	    gkrellm_inet_log_tcp_port_data(&tcp);
       }
 
-      next = (struct inpcb *)inpcb.inp_queue.cqe_next;
+      next = TAILQ_NEXT(&inpcb, inp_queue);
    }
 }
 #endif
