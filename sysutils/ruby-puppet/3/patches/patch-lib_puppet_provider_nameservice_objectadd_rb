$OpenBSD: patch-lib_puppet_provider_nameservice_objectadd_rb,v 1.1 2014/11/04 09:03:58 jasper Exp $

- use '-S' to update group membership on OpenBSD

--- lib/puppet/provider/nameservice/objectadd.rb.orig	Sun Nov  2 20:53:06 2014
+++ lib/puppet/provider/nameservice/objectadd.rb	Sun Nov  2 20:53:14 2014
@@ -14,7 +14,13 @@ class ObjectAdd < Puppet::Provider::NameService
 
   def modifycmd(param, value)
     cmd = [command(param.to_s =~ /password_.+_age/ ? :password : :modify)]
-    cmd << flag(param) << value
+    debug "param: #{param} value: #{value}"
+    # Modifying groups may use different flags as for setting groups
+    if param == :groups
+      cmd << modifygroupsflag << value
+    else
+      cmd << flag(param) << value
+    end
     if @resource.allowdupe? && ((param == :uid) || (param == :gid and self.class.name == :groupadd))
       cmd << "-o"
     end
@@ -28,6 +34,15 @@ class ObjectAdd < Puppet::Provider::NameService
     method = self.class.option(name, :method) || name
 
     method
+  end
+
+  def modifygroupsflag
+    case Facter.value(:osfamily)
+    when 'OpenBSD'
+      '-S'
+    else
+      flag(:groups)
+    end
   end
 end
 end
