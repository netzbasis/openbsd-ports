$OpenBSD: patch-pdf-backend_cc,v 1.5 2020/02/17 20:35:18 kili Exp $

Fix build with poppler-0.83.0 and -0.85.0.

Index: pdf-backend.cc
--- pdf-backend.cc.orig
+++ pdf-backend.cc
@@ -48,7 +48,7 @@
  * ======================
  */
 
-static void poppler_error_handler(void *data, ErrorCategory category, pdf::Offset pos, const char *message)
+static void poppler_error_handler(ErrorCategory category, pdf::Offset pos, const char *message)
 {
   std::string format;
   const char *category_name = _("PDF error");
@@ -103,8 +103,8 @@ static void poppler_error_handler(void *data, ErrorCat
 
 pdf::Environment::Environment()
 {
-  globalParams = new GlobalParams();
-  setErrorCallback(poppler_error_handler, nullptr);
+  globalParams = std::make_unique<GlobalParams>();
+  setErrorCallback(poppler_error_handler);
 }
 
 void pdf::Environment::set_antialias(bool value)
@@ -499,12 +499,11 @@ bool pdf::get_glyph(splash::Splash *splash, splash::Fo
 void pdf::Renderer::convert_path(pdf::gfx::State *state, splash::Path &splash_path)
 {
   /* Source was copied from <poppler/SplashOutputDev.c>. */
-  pdf::gfx::Subpath *subpath;
-  pdf::gfx::Path *path = state->getPath();
+  const pdf::gfx::Path *path = state->getPath();
   int n_subpaths = path->getNumSubpaths();
   for (int i = 0; i < n_subpaths; i++)
   {
-    subpath = path->getSubpath(i);
+    const pdf::gfx::Subpath *subpath = path->getSubpath(i);
     if (subpath->getNumPoints() > 0)
     {
       double x1, y1, x2, y2, x3, y3;
