$OpenBSD: patch-src_Makefile,v 1.1 2017/04/21 20:34:19 bentley Exp $
Fix build with multiple versions of gperf.

From upstream 4390f1c84e8fee51fc22468821e6fc158e783053.
--- src/Makefile.orig	Thu Apr 20 09:06:18 2017
+++ src/Makefile	Thu Apr 20 09:07:08 2017
@@ -1,13 +1,17 @@
 # Sources
 DIR_SOURCES := svgtiny.c svgtiny_gradient.c svgtiny_list.c
 
-SOURCES := $(SOURCES) $(BUILDDIR)/src_colors.c
+SOURCES := $(SOURCES)
 
-$(BUILDDIR)/src_colors.c: src/colors.gperf
+$(DIR)autogenerated_colors.c: src/colors.gperf
 	$(VQ)$(ECHO) "   GPERF: $<"
 	$(Q)gperf --output-file=$@.tmp $<
-# Hack for GCC 4.2 compatibility (gperf 3.0.4 solves this properly)
-	$(Q)$(SED) -e 's/#ifdef __GNUC_STDC_INLINE__/#if defined __GNUC_STDC_INLINE__ || defined __GNUC_GNU_INLINE__/' $@.tmp >$@
+# Squash "error: no previous declaration for 'svgtiny_color_lookup'"
+	$(Q)$(SED) -e 's/^\(const struct svgtiny_named_color\)/static \1/' $@.tmp >$@
 	$(Q)$(RM) $@.tmp
+
+PRE_TARGETS := $(DIR)autogenerated_colors.c
+
+CLEAN_ITEMS := $(DIR)autogenerated_colors.c
 
 include $(NSBUILD)/Makefile.subdir
