$OpenBSD: patch-base_process_process_linux_cc,v 1.1 2019/05/26 08:22:47 robert Exp $

Index: base/process/process_linux.cc
--- base/process/process_linux.cc.orig
+++ base/process/process_linux.cc
@@ -74,6 +74,7 @@ const int kBackgroundPriority = 5;
 }  // namespace
 
 Time Process::CreationTime() const {
+#if !defined(OS_BSD)
   int64_t start_ticks = is_current()
                             ? internal::ReadProcSelfStatsAndGetFieldAsInt64(
                                   internal::VM_STARTTIME)
@@ -86,6 +87,31 @@ Time Process::CreationTime() const {
   if (boot_time.is_null())
     return Time();
   return Time(boot_time + start_offset);
+#else
+  int mib[] = { CTL_KERN, KERN_PROC, KERN_PROC_PID, getpid(),
+               sizeof(struct kinfo_proc), 0 };
+  struct kinfo_proc *info = nullptr;
+  size_t info_size;
+  Time ct = Time();
+
+  if (sysctl(mib, base::size(mib), NULL, &info_size, NULL, 0) < 0)
+    goto out;
+
+  mib[5] = (info_size / sizeof(struct kinfo_proc));
+  if ((info = reinterpret_cast<kinfo_proc*>(malloc(info_size))) == NULL)
+    goto out;
+
+  if (sysctl(mib, base::size(mib), info, &info_size, NULL, 0) < 0)
+    goto out;
+
+  ct = Time::FromTimeT(info->p_ustart_sec);
+
+out:
+  if (info)
+    free(info);
+
+  return ct;
+#endif
 }
 
 // static
