$OpenBSD: patch-apps_user_ldap_lib_access_php,v 1.2 2015/11/16 09:53:12 ajacoutot Exp $

From a2f2ffb8dbcb7f9cb0fe139f592be0d4772bec20 Mon Sep 17 00:00:00 2001
From: Arthur Schiwon <blizzz@owncloud.com>
Date: Fri, 30 Oct 2015 19:20:42 +0100
Subject: [PATCH] if a user that is flag as deleted shows up again, remove that flag. Fixes #20090

--- apps/user_ldap/lib/access.php.orig	Mon Oct 19 15:21:54 2015
+++ apps/user_ldap/lib/access.php	Mon Nov 16 10:50:47 2015
@@ -35,6 +35,7 @@
 
 namespace OCA\user_ldap\lib;
 
+use OCA\user_ldap\lib\user\OfflineUser;
 use OCA\User_LDAP\Mapping\AbstractMapping;
 
 /**
@@ -695,6 +696,10 @@ class Access extends LDAPUtility implements user\IUser
 			$ocName  = $this->dn2ocname($userRecord['dn'][0], $userRecord[$this->connection->ldapUserDisplayName]);
 			$this->cacheUserExists($ocName);
 			$user = $this->userManager->get($ocName);
+			if($user instanceof OfflineUser) {
+				$user->unmark();
+				$user = $this->userManager->get($ocName);
+			}
 			$user->processAttributes($userRecord);
 		}
 	}
