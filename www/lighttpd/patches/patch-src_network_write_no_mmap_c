$OpenBSD: patch-src_network_write_no_mmap_c,v 1.1 2016/10/12 08:09:26 ajacoutot Exp $

performance: use Linux extended syscalls and flags

--- src/network_write_no_mmap.c.orig	Sun Jul 31 08:42:39 2016
+++ src/network_write_no_mmap.c	Mon Oct 10 18:04:38 2016
@@ -38,11 +38,10 @@ int network_open_file_chunk(server *srv, connection *c
 			return -1;
 		}
 
-		if (-1 == (c->file.fd = open(c->file.name->ptr, O_RDONLY|O_NOCTTY))) {
+		if (-1 == (c->file.fd = fdevent_open_cloexec(c->file.name->ptr, O_RDONLY, 0))) {
 			log_error_write(srv, __FILE__, __LINE__, "ssb", "open failed:", strerror(errno), c->file.name);
 			return -1;
 		}
-		fd_close_on_exec(c->file.fd);
 
 		file_size = sce->st.st_size;
 	} else {
