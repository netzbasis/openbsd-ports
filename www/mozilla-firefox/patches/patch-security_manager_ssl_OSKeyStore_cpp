$OpenBSD: patch-security_manager_ssl_OSKeyStore_cpp,v 1.1 2020/05/26 14:03:49 landry Exp $

backport https://hg.mozilla.org/mozilla-central/rev/463069687b3d
fixes webrtc w/ nss 3.52
cf https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=246363
cf https://bugzilla.mozilla.org/show_bug.cgi?id=1636632
cf https://bugzilla.mozilla.org/show_bug.cgi?id=1624128

Index: security/manager/ssl/OSKeyStore.cpp
--- security/manager/ssl/OSKeyStore.cpp.orig
+++ security/manager/ssl/OSKeyStore.cpp
@@ -663,6 +663,7 @@ nsresult AbstractOSKeyStore::DoCipher(const UniquePK11
   CK_GCM_PARAMS gcm_params;
   gcm_params.pIv = const_cast<unsigned char*>(ivp);
   gcm_params.ulIvLen = mIVLength;
+  gcm_params.ulIvBits = gcm_params.ulIvLen * 8;
   gcm_params.ulTagBits = 128;
   gcm_params.pAAD = nullptr;
   gcm_params.ulAADLen = 0;
