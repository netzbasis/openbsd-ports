$OpenBSD: patch-xpcom_base_nsMemoryReporterManager_cpp,v 1.3 2018/09/05 16:19:01 landry Exp $

neuter KERN_PROC sysctl when running w/ pledge
https://hg.mozilla.org/mozilla-central/rev/3ad8c54c6dc8

Index: xpcom/base/nsMemoryReporterManager.cpp
--- xpcom/base/nsMemoryReporterManager.cpp.orig
+++ xpcom/base/nsMemoryReporterManager.cpp
@@ -220,6 +220,12 @@ SystemHeapSize(int64_t* aSizeOut)
 static MOZ_MUST_USE nsresult
 GetKinfoProcSelf(KINFO_PROC* aProc)
 {
+#if defined(__OpenBSD__) && defined(MOZ_SANDBOX)
+  static LazyLogModule sPledgeLog("SandboxPledge");
+  MOZ_LOG(sPledgeLog, LogLevel::Debug,
+         ("%s called when pledged\n", __func__));
+  return NS_ERROR_FAILURE;
+#endif
   int mib[] = {
     CTL_KERN,
     KERN_PROC,
