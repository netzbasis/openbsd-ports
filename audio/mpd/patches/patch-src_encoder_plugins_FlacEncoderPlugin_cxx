$OpenBSD: patch-src_encoder_plugins_FlacEncoderPlugin_cxx,v 1.1 2015/10/20 15:10:42 dcoppa Exp $

commit 4e3d1821895c92d060fc3a9059e83ac58c8c79a3
Author: Max Kellermann <max@duempel.org>
Date:   Fri Oct 16 18:05:34 2015 +0200

encoder/flac: fix crash with 32 bit playback

--- src/encoder/plugins/FlacEncoderPlugin.cxx.orig	Sat Oct 25 00:28:53 2014
+++ src/encoder/plugins/FlacEncoderPlugin.cxx	Tue Oct 20 16:32:38 2015
@@ -157,8 +157,6 @@ flac_encoder_open(Encoder *_encoder, AudioFormat &audi
 	struct flac_encoder *encoder = (struct flac_encoder *)_encoder;
 	unsigned bits_per_sample;
 
-	encoder->audio_format = audio_format;
-
 	/* FIXME: flac should support 32bit as well */
 	switch (audio_format.format) {
 	case SampleFormat::S8:
@@ -177,6 +175,8 @@ flac_encoder_open(Encoder *_encoder, AudioFormat &audi
 		bits_per_sample = 24;
 		audio_format.format = SampleFormat::S24_P32;
 	}
+
+	encoder->audio_format = audio_format;
 
 	/* allocate the encoder */
 	encoder->fse = FLAC__stream_encoder_new();
