$OpenBSD: patch-cmake_modules_TpQtMacros_cmake,v 1.4 2016/06/13 08:27:42 jasper Exp $

1. Unbreak building with Ninja generator.
https://cgit.freedesktop.org/telepathy/telepathy-qt/commit/?id=d9354dfe8cca364e4a8c3a44c302ceb714c53911

2. Fix linking order.

--- cmake/modules/TpQtMacros.cmake.orig	Tue Sep  9 00:13:43 2014
+++ cmake/modules/TpQtMacros.cmake	Mon Jun 13 10:01:38 2016
@@ -223,7 +223,9 @@ function(tpqt_client_generator spec group pretty_inclu
         WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
 
         DEPENDS ${CMAKE_SOURCE_DIR}/tools/libqtcodegen.py
-                ${CMAKE_SOURCE_DIR}/tools/qt-client-gen.py)
+                ${CMAKE_SOURCE_DIR}/tools/qt-client-gen.py
+                ${CMAKE_CURRENT_BINARY_DIR}/_gen/stable-spec.xml
+                ${CMAKE_CURRENT_BINARY_DIR}/_gen/spec-${spec}.xml)
     add_custom_target(generate_cli-${spec}-body DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/_gen/cli-${spec}-body.hpp)
     add_dependencies(all-generated-sources generate_cli-${spec}-body)
 
@@ -259,7 +261,9 @@ function(tpqt_future_client_generator spec namespace)
         WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
 
         DEPENDS ${CMAKE_SOURCE_DIR}/tools/libqtcodegen.py
-                ${CMAKE_SOURCE_DIR}/tools/qt-client-gen.py)
+                ${CMAKE_SOURCE_DIR}/tools/qt-client-gen.py
+                ${CMAKE_CURRENT_BINARY_DIR}/_gen/future-spec.xml
+                ${CMAKE_CURRENT_BINARY_DIR}/_gen/future-${spec}.xml)
     add_custom_target(generate_future-${spec}-body DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/_gen/future-${spec}-body.hpp)
     add_dependencies(all-generated-sources generate_future-${spec}-body)
 
@@ -294,7 +298,9 @@ function(tpqt_service_generator spec group pretty_incl
         WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
 
         DEPENDS ${CMAKE_SOURCE_DIR}/tools/libqtcodegen.py
-                ${CMAKE_SOURCE_DIR}/tools/qt-svc-gen.py)
+                ${CMAKE_SOURCE_DIR}/tools/qt-svc-gen.py
+                ${CMAKE_CURRENT_BINARY_DIR}/_gen/stable-spec.xml
+                ${CMAKE_CURRENT_BINARY_DIR}/_gen/spec-svc-${spec}.xml)
     add_custom_target(generate_service-${spec}-body DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/_gen/svc-${spec}.cpp)
     add_dependencies(all-generated-service-sources generate_service-${spec}-body)
 
@@ -404,7 +410,15 @@ endfunction(tpqt_types_gen _TARGET_NAME _SPEC_XML _OUT
 macro(tpqt_add_generic_unit_test _fancyName _name)
     tpqt_generate_moc_i(${_name}.cpp ${CMAKE_CURRENT_BINARY_DIR}/_gen/${_name}.cpp.moc.hpp)
     add_executable(test-${_name} ${_name}.cpp ${CMAKE_CURRENT_BINARY_DIR}/_gen/${_name}.cpp.moc.hpp)
-    target_link_libraries(test-${_name} ${QT_QTCORE_LIBRARY} ${QT_QTNETWORK_LIBRARY} ${QT_QTXML_LIBRARY} ${QT_QTTEST_LIBRARY} telepathy-qt${QT_VERSION_MAJOR} tp-qt-tests ${TP_QT_EXECUTABLE_LINKER_FLAGS} ${ARGN})
+    target_link_libraries(test-${_name}
+      ${TP_QT_EXECUTABLE_LINKER_FLAGS}
+      tp-qt-tests ${ARGN}
+      telepathy-qt${QT_VERSION_MAJOR}
+      ${QT_QTTEST_LIBRARY}
+      ${QT_QTXML_LIBRARY}
+      ${QT_QTNETWORK_LIBRARY}
+      ${QT_QTCORE_LIBRARY}
+      )
     add_test(${_fancyName} ${SH} ${CMAKE_CURRENT_BINARY_DIR}/runGenericTest.sh ${CMAKE_CURRENT_BINARY_DIR}/test-${_name})
     list(APPEND _telepathy_qt_test_cases test-${_name})
 
@@ -415,7 +429,17 @@ endmacro(tpqt_add_generic_unit_test _fancyName _name)
 macro(tpqt_add_dbus_unit_test _fancyName _name)
     tpqt_generate_moc_i(${_name}.cpp ${CMAKE_CURRENT_BINARY_DIR}/_gen/${_name}.cpp.moc.hpp)
     add_executable(test-${_name} ${_name}.cpp ${CMAKE_CURRENT_BINARY_DIR}/_gen/${_name}.cpp.moc.hpp)
-    target_link_libraries(test-${_name} ${QT_QTCORE_LIBRARY} ${QT_QTDBUS_LIBRARY} ${QT_QTNETWORK_LIBRARY} ${QT_QTXML_LIBRARY} ${QT_QTTEST_LIBRARY} telepathy-qt${QT_VERSION_MAJOR} tp-qt-tests ${TP_QT_EXECUTABLE_LINKER_FLAGS} ${ARGN})
+    target_link_libraries(test-${_name}
+      ${TP_QT_EXECUTABLE_LINKER_FLAGS}
+      ${ARGN}
+      tp-qt-tests
+      telepathy-qt${QT_VERSION_MAJOR}   
+      ${QT_QTTEST_LIBRARY}
+      ${QT_QTDBUS_LIBRARY}
+      ${QT_QTXML_LIBRARY}
+      ${QT_QTNETWORK_LIBRARY}
+      ${QT_QTCORE_LIBRARY}
+      )
     set(with_session_bus ${CMAKE_CURRENT_BINARY_DIR}/runDbusTest.sh)
     add_test(${_fancyName} ${SH} ${with_session_bus} ${CMAKE_CURRENT_BINARY_DIR}/test-${_name})
     list(APPEND _telepathy_qt_test_cases test-${_name})
