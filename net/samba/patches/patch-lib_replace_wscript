$OpenBSD: patch-lib_replace_wscript,v 1.2 2016/04/12 17:42:09 jca Exp $

Fix __sync_fetch_and_add check so that it properly fails instead of
succeeding erroneously (eg on hppa/mips64).

Also fix atomic_add_32 check so that it doesn't get picked up instead.

--- lib/replace/wscript.orig	Tue Sep  8 15:45:25 2015
+++ lib/replace/wscript	Sun Apr 10 19:38:58 2016
@@ -197,23 +197,15 @@ def configure(conf):
 
     # Check for atomic builtins. */
     conf.CHECK_CODE('''
-                    int main(void) {
                         int i;
                         (void)__sync_fetch_and_add(&i, 1);
-                        return 0;
-                    }
                     ''',
                     'HAVE___SYNC_FETCH_AND_ADD',
                     msg='Checking for __sync_fetch_and_add compiler builtin')
 
     conf.CHECK_CODE('''
-                    #include <stdint.h>
-                    #include <sys/atomic.h>
-                    int main(void) {
                         int32_t i;
                         atomic_add_32(&i, 1);
-                        return 0;
-                    }
                     ''',
                     'HAVE_ATOMIC_ADD_32',
                     headers='stdint.h sys/atomic.h',
