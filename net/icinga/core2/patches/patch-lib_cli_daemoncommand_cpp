$OpenBSD: patch-lib_cli_daemoncommand_cpp,v 1.3 2015/10/21 09:03:22 sthen Exp $

From 3c6f0e31d9177bf0736ad247df0bb3bf0696e969 Mon Sep 17 00:00:00 2001
From: Gunnar Beutner <gunnar@beutner.name>
Date: Tue, 20 Oct 2015 22:55:16 +0200
Subject: [PATCH] Make sure the timer thread is gone when calling fork()

refs #10410

--- lib/cli/daemoncommand.cpp.orig	Tue Oct 20 22:13:39 2015
+++ lib/cli/daemoncommand.cpp	Tue Oct 20 22:14:21 2015
@@ -70,7 +70,7 @@ static void SigHupHandler(int)
 static bool Daemonize(void)
 {
 #ifndef _WIN32
-	Application::GetTP().Stop();
+	Application::UninitializeBase();
 
 	pid_t pid = fork();
 	if (pid == -1) {
@@ -103,7 +103,7 @@ static bool Daemonize(void)
 		_exit(EXIT_SUCCESS);
 	}
 
-	Application::GetTP().Start();
+	Application::InitializeBase();
 #endif /* _WIN32 */
 
 	return true;
