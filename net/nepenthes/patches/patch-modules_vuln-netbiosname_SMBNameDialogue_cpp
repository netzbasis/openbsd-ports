$OpenBSD: patch-modules_vuln-netbiosname_SMBNameDialogue_cpp,v 1.1 2018/04/16 23:05:32 jca Exp $

Index: modules/vuln-netbiosname/SMBNameDialogue.cpp
--- modules/vuln-netbiosname/SMBNameDialogue.cpp.orig
+++ modules/vuln-netbiosname/SMBNameDialogue.cpp
@@ -78,7 +78,7 @@ FIXME
 [ module ] =-------------------------------------------------------------------------=
 */
 
-char smb_session_req0[] = {
+unsigned char smb_session_req0[] = {
 0x81, 0x00, 0x00, 0x44, 0x20, 0x43, 0x4b, 0x46, 
 0x44, 0x45, 0x4e, 0x45, 0x43, 0x46, 0x44, 0x45, 
 0x46, 0x46, 0x43, 0x46, 0x47, 0x45, 0x46, 0x46, 
@@ -88,9 +88,9 @@ char smb_session_req0[] = {
 0x44, 0x43, 0x41, 0x43, 0x41, 0x43, 0x41, 0x43, 
 0x41, 0x43, 0x41, 0x43, 0x41, 0x43, 0x41, 0x43, 
 0x41, 0x43, 0x41, 0x43, 0x41, 0x41, 0x41, 0x00 };
-char smb_session_reply0[] = {
+unsigned char smb_session_reply0[] = {
 0x82, 0x00, 0x00, 0x00 };
-char smb_negotiate_req0[] = {
+unsigned char smb_negotiate_req0[] = {
 0x00, 0x00, 0x00, 0x2f, 0xff, 0x53, 0x4d, 0x42, 
 0x72, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
@@ -98,7 +98,7 @@ char smb_negotiate_req0[] = {
 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x02, 
 0x4e, 0x54, 0x20, 0x4c, 0x4d, 0x20, 0x30, 0x2e, 
 0x31, 0x32, 0x00 };
-char smb_negotiate_reply0[] = {
+unsigned char smb_negotiate_reply0[] = {
 0x00, 0x00, 0x00, 0x7d, 0xff, 0x53, 0x4d, 0x42, 
 0x72, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
@@ -222,7 +222,7 @@ ConsumeLevel SMBNameDialogue::incomingData(Message *ms
 			 memcmp(m_Buffer->getData(),smb_negotiate_req0,sizeof(smb_negotiate_req0)) == 0 )
 		{
 			logSpam("SMB Negotiate request %i\n", m_Buffer->getSize());
-			msg->getResponder()->doRespond(smb_negotiate_reply0,sizeof(smb_negotiate_reply0));
+			msg->getResponder()->doRespond((char *)smb_negotiate_reply0,sizeof(smb_negotiate_reply0));
 			m_State = SMBName_DONE;
 			m_Buffer->cut(sizeof(smb_negotiate_req0));
 		}else
