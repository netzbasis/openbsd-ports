$OpenBSD: patch-src_socks_c,v 1.1 2018/01/22 12:30:38 sthen Exp $

Index: src/socks.c
--- src/socks.c.orig
+++ src/socks.c
@@ -281,7 +281,7 @@ static int send_socksv4a_request(struct connreq *conn,
     struct sockreq *thisreq;
     int endOfUser;
     /* Determine the current username */
-    user = getpwuid(getuid());
+    user = NULL;
 
     thisreq = (struct sockreq *) conn->buffer;
     endOfUser=sizeof(struct sockreq) +
@@ -324,7 +324,7 @@ static int send_socksv4_request(struct connreq *conn)
     struct sockreq *thisreq;
 
     /* Determine the current username */
-    user = getpwuid(getuid());
+    user = NULL;
 
     thisreq = (struct sockreq *) conn->buffer;
 
@@ -493,7 +493,7 @@ static int read_socksv5_method(struct connreq *conn)
         show_msg(MSGDEBUG, "SOCKS V5 server chose username/password authentication\n");
 
         /* Determine the current *nix username */
-        nixuser = getpwuid(getuid());
+        nixuser = NULL;
 
         if (((uname = conn->path->defuser) == NULL) &&
           ((uname = getenv("TORSOCKS_USERNAME")) == NULL) &&
