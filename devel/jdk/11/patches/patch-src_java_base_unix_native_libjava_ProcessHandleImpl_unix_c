$OpenBSD: patch-src_java_base_unix_native_libjava_ProcessHandleImpl_unix_c,v 1.1 2019/06/17 19:23:40 kurt Exp $

Emulate waitid(2) with kqueue(2)

Index: src/java.base/unix/native/libjava/ProcessHandleImpl_unix.c
--- src/java.base/unix/native/libjava/ProcessHandleImpl_unix.c.orig
+++ src/java.base/unix/native/libjava/ProcessHandleImpl_unix.c
@@ -259,8 +259,9 @@ Java_java_lang_ProcessHandleImpl_waitForProcessExit0(J
             return status;
         }
      } else {
-// This should be config check for waitid
-#ifndef __OpenBSD__
+#if defined(__OpenBSD__)
+        return os_waitForProcessExitNoReap(pid);
+#else
         /*
          * Wait for the child process to exit without reaping the exitValue.
          * waitid() is standard on all POSIX platforms.
@@ -292,10 +293,6 @@ Java_java_lang_ProcessHandleImpl_waitForProcessExit0(J
               */
              return siginfo.si_status;
         }
-#else
-        JNU_ThrowByName(env, "java/lang/UnsupportedOperationException",
-                "unsupported option");
-        return -1;
 #endif
     }
 }
