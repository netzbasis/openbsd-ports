$OpenBSD: patch-glib_deprecated_gthread-deprecated_c,v 1.1 2014/10/22 15:58:37 ajacoutot Exp $

From 68b2b63e12500736cb6ec3194b8d3ec72b4699b3 Mon Sep 17 00:00:00 2001
From: Benjamin Gilbert <bgilbert@backtick.net>
Date: Thu, 9 Oct 2014 00:07:36 -0400
Subject: Fix g_cond_timed_wait() timeout with !CLOCK_MONOTONIC

--- glib/deprecated/gthread-deprecated.c.orig	Mon Sep 22 15:42:12 2014
+++ glib/deprecated/gthread-deprecated.c	Wed Oct 22 17:44:33 2014
@@ -1564,16 +1564,10 @@ g_cond_timed_wait (GCond    *cond,
   end_time *= 1000000;
   end_time += abs_time->tv_usec;
 
-#ifdef CLOCK_MONOTONIC
   /* would be nice if we had clock_rtoffset, but that didn't seem to
    * make it into the kernel yet...
    */
   end_time += g_get_monotonic_time () - g_get_real_time ();
-#else
-  /* if CLOCK_MONOTONIC is not defined then g_get_montonic_time() and
-   * g_get_real_time() are returning the same clock, so don't bother...
-   */
-#endif
 
   return g_cond_wait_until (cond, mutex, end_time);
 }
