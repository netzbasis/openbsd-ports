$OpenBSD: patch-mesonbuild_build_py,v 1.2 2017/11/04 14:27:40 ajacoutot Exp $

Index: mesonbuild/build.py
--- mesonbuild/build.py.orig
+++ mesonbuild/build.py
@@ -19,7 +19,7 @@ import itertools
 from . import environment
 from . import dependencies
 from . import mlog
-from .mesonlib import File, MesonException, listify, extract_as_list
+from .mesonlib import File, MesonException, listify, extract_as_list, is_openbsd
 from .mesonlib import typeslistify, stringlistify, classify_unity_sources
 from .mesonlib import get_filenames_templates_dict, substitute_values
 from .environment import for_windows, for_darwin, for_cygwin
@@ -1397,6 +1397,11 @@ class SharedLibrary(BuildTarget):
             # We replicate what Autotools does here and take the first
             # number of the version by default.
             self.soversion = self.ltversion.split('.')[0]
+        if is_openbsd():
+            libversion = os.getenv('LIB' + self.name + '_VERSION')
+            if libversion is not None:
+                self.ltversion = libversion.format(self)
+                self.soversion = self.ltversion
         # Visual Studio module-definitions file
         if 'vs_module_defs' in kwargs:
             path = kwargs['vs_module_defs']
@@ -1458,6 +1463,8 @@ class SharedLibrary(BuildTarget):
         aliases = {}
         # Aliases are only useful with .so and .dylib libraries. Also if
         # there's no self.soversion (no versioning), we don't need aliases.
+        if is_openbsd():
+            return {}
         if self.suffix not in ('so', 'dylib') or not self.soversion:
             return {}
         # With .so libraries, the minor and micro versions are also in the
