$OpenBSD: patch-src_tests_tests_cpp,v 1.1 2018/04/12 09:53:54 bluhm Exp $

https://github.com/randombit/botan/commit/c6a90da3f5a43411c6cd5a481b4af6a2b301cc11

Index: src/tests/tests.cpp
--- src/tests/tests.cpp.orig
+++ src/tests/tests.cpp
@@ -23,6 +23,11 @@
    #include <botan/point_gfp.h>
 #endif
 
+#if defined(BOTAN_TARGET_OS_HAS_POSIX1)
+   #include <stdlib.h>
+   #include <unistd.h>
+#endif
+
 namespace Botan_Tests {
 
 Test::Registration::Registration(const std::string& name, Test* test)
@@ -493,6 +498,33 @@ Test* Test::get_test(const std::string& test_name)
       return i->second.get();
       }
    return nullptr;
+   }
+
+//static
+std::string Test::temp_file_name(const std::string& basename)
+   {
+   // TODO add a --tmp-dir option to the tests to specify where these files go
+
+#if defined(BOTAN_TARGET_OS_HAS_POSIX1)
+
+   // POSIX only calls for 6 'X' chars but OpenBSD allows arbitrary amount
+   std::string mkstemp_basename = "/tmp/" + basename + ".XXXXXXXXXX";
+
+   int fd = ::mkstemp(&mkstemp_basename[0]);
+
+   // error
+   if(fd < 0)
+      {
+      return "";
+      }
+
+   ::close(fd);
+
+   return mkstemp_basename;
+#else
+   // For now just create the temp in the current working directory
+   return basename;
+#endif
    }
 
 std::string Test::read_data_file(const std::string& path)
