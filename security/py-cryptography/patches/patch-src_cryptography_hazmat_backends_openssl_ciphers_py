$OpenBSD: patch-src_cryptography_hazmat_backends_openssl_ciphers_py,v 1.1 2018/07/31 11:08:18 jasper Exp $

Security fix for CVE-2018-10903
https://github.com/pyca/cryptography/pull/4342

Index: src/cryptography/hazmat/backends/openssl/ciphers.py
--- src/cryptography/hazmat/backends/openssl/ciphers.py.orig
+++ src/cryptography/hazmat/backends/openssl/ciphers.py
@@ -202,6 +202,11 @@ class _CipherContext(object):
                 "finalize_with_tag requires OpenSSL >= 1.0.2. To use this "
                 "method please update OpenSSL"
             )
+        if len(tag) < self._mode._min_tag_length:
+            raise ValueError(
+                "Authentication tag must be {0} bytes or longer.".format(
+                    self._mode._min_tag_length)
+            )
         res = self._backend._lib.EVP_CIPHER_CTX_ctrl(
             self._ctx, self._backend._lib.EVP_CTRL_AEAD_SET_TAG,
             len(tag), tag
