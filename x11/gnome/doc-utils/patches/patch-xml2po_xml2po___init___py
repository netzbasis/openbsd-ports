$OpenBSD: patch-xml2po_xml2po___init___py,v 1.1 2020/06/09 07:19:28 jasper Exp $

https://gitweb.gentoo.org/repo/gentoo.git/tree/app-text/gnome-doc-utils/files/gnome-doc-utils-0.20.10-python3.patch

Index: xml2po/xml2po/__init__.py
--- xml2po/xml2po/__init__.py.orig
+++ xml2po/xml2po/__init__.py
@@ -326,7 +326,7 @@ class XMLDocument(object):
                 pass
 
             content = '<%s>%s</%s>' % (starttag, text, endtag)
-            tmp = tmp + content.encode('utf-8')
+            tmp = tmp + content
 
             newnode = None
             try:
@@ -352,9 +352,10 @@ class XMLDocument(object):
 
                 if node:
                     copy = newelem.copyNodeList()
-                    next = node.next
+                    #next = node.next
                     node.replaceNode(newelem.copyNodeList())
-                    node.next = next
+                    #print(type(next))
+                    #node.next = next
 
             else:
                 # In practice, this happens with tags such as "<para>    </para>" (only whitespace in between)
@@ -470,7 +471,7 @@ class XMLDocument(object):
 
         worth = self.worthOutputting(node)
         if not translation:
-            translation = outtxt.decode('utf-8')
+            translation = outtxt
             if worth and self.app.options.get('mark_untranslated'):
                 node.setLang('C')
 
@@ -577,7 +578,7 @@ class Main(object):
                 raise IOError("Unable to read file '%s'" % xmlfile)
             try:
                 doc = XMLDocument(xmlfile, self)
-            except Exception, e:
+            except Exception as e:
                 print >> sys.stderr, "Unable to parse XML file '%s': %s" % (xmlfile, str(e))
                 sys.exit(1)
             self.current_mode.preProcessXml(doc.doc, self.msg)
@@ -590,7 +591,7 @@ class Main(object):
             raise IOError("Unable to read file '%s'" % xmlfile)
         try:
             doc = XMLDocument(xmlfile, self)
-        except Exception, e:
+        except Exception as e:
             print >> sys.stderr, str(e)
             sys.exit(1)
 
@@ -619,7 +620,7 @@ class Main(object):
             raise IOError("Unable to read file '%s'" % xmlfile)
         try:
             doc = XMLDocument(xmlfile, self)
-        except Exception, e:
+        except Exception as e:
             print >> sys.stderr, str(e)
             sys.exit(1)
         doc.generate_messages()
@@ -627,7 +628,7 @@ class Main(object):
         self.msg.translationsFollow()
         try:
             doc = XMLDocument(origxml, self)
-        except Exception, e:
+        except Exception as e:
             print >> sys.stderr, str(e)
             sys.exit(1)
         doc.generate_messages()
@@ -663,7 +664,7 @@ class Main(object):
         if not text or text.strip() == '':
             return text
         if self.gt:
-            res = self.gt.ugettext(text.decode('utf-8'))
+            res = self.gt.gettext(text)
             return res
 
         return text
