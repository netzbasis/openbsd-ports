$OpenBSD: patch-libide_subprocess_ide-subprocess-launcher_c,v 1.1 2016/11/12 16:27:58 ajacoutot Exp $

From 7b68bdcb3e2925dff94c1fea555557e2e5470662 Mon Sep 17 00:00:00 2001
From: Christian Hergert <chergert@redhat.com>
Date: Fri, 11 Nov 2016 15:26:35 -0800
Subject: subprocess-launcher: setup IOCSCTTY on stdin_fd after setsid()

--- libide/subprocess/ide-subprocess-launcher.c.orig	Mon Oct 31 11:22:25 2016
+++ libide/subprocess/ide-subprocess-launcher.c	Sat Nov 12 08:55:08 2016
@@ -21,6 +21,7 @@
 #include <signal.h>
 #include <stdlib.h>
 #include <string.h>
+#include <sys/ioctl.h>
 #include <unistd.h>
 
 #include "ide-debug.h"
@@ -68,12 +69,17 @@ static void
 child_setup_func (gpointer data)
 {
 #ifdef G_OS_UNIX
+  IdeSubprocessLauncherPrivate *priv = data;
+
   /*
    * TODO: Check on FreeBSD to see if the process group id is the same as
    *       the owning process. If not, our kill() signal might not work
    *       as expected.
    */
   setsid ();
+
+  if (isatty (priv->stdin_fd))
+    ioctl (priv->stdin_fd, TIOCSCTTY, 0);
 #endif
 }
 
@@ -232,7 +238,7 @@ ide_subprocess_launcher_spawn_worker (GTask        *ta
 #endif
 
   launcher = g_subprocess_launcher_new (priv->flags);
-  g_subprocess_launcher_set_child_setup (launcher, child_setup_func, NULL, NULL);
+  g_subprocess_launcher_set_child_setup (launcher, child_setup_func, priv, NULL);
   g_subprocess_launcher_set_cwd (launcher, priv->cwd);
 
   if (priv->stdin_fd)
