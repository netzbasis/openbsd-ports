$OpenBSD: patch-fishmon_c,v 1.3 2014/10/03 13:28:40 dcoppa Exp $

Unbreak with GTK+ >= 2.18

--- fishmon.c.orig	Thu May 13 01:55:59 2004
+++ fishmon.c	Fri Oct  3 15:11:09 2014
@@ -152,6 +152,7 @@ static char month[12][4] = { "JAN", "FEB", "MAR", "APR
 
 int main(int argc, char **argv)
 {
+    setenv("GDK_NATIVE_WINDOWS", "1", 0);
     int ch;
     GdkEvent *event;
 #ifdef PRO
@@ -564,7 +565,7 @@ static void prepare_backbuffer(int solid)
     curr_time = time(NULL);
     data = localtime(&curr_time);
 
-    sprintf(buffer, "%s %02d-%s", weekday[data->tm_wday],
+    snprintf(buffer, sizeof(buffer), "%s %02d-%s", weekday[data->tm_wday],
 	    data->tm_mday, month[data->tm_mon]);
 
     draw_string(2, 47, buffer);
@@ -648,6 +649,7 @@ static void make_new_fishmon_dockapp(void)
 
     /* make a copy for the iconwin - parameters are the same */
     memcpy(&attri, &attr, sizeof(GdkWindowAttr));
+    attri.window_type = GDK_WINDOW_CHILD;
 
     sizehints.flags = USSize;
     sizehints.width = 64;
@@ -679,7 +681,6 @@ static void make_new_fishmon_dockapp(void)
     wmhints.window_group = win;
     wmhints.flags =
 	StateHint | IconWindowHint | IconPositionHint | WindowGroupHint;
-    XSetWMHints(GDK_WINDOW_XDISPLAY(bm.win), win, &wmhints);
 
     bm.gc = gdk_gc_new(bm.win);
 
@@ -692,6 +693,9 @@ static void make_new_fishmon_dockapp(void)
     gdk_window_set_back_pixmap(bm.iconwin, bm.pixmap, False);
 
     gdk_window_show(bm.win);
+
+    XSetWMHints(GDK_WINDOW_XDISPLAY(bm.win), win, &wmhints);
+    gdk_window_show(bm.iconwin);
 
 #undef MASK
 }				/* make_new_fishmon_dockapp */
