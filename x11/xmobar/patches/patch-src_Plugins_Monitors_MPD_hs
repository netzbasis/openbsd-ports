$OpenBSD: patch-src_Plugins_Monitors_MPD_hs,v 1.5 2014/09/29 10:10:45 dcoppa Exp $

commit 6b9dfabf23b7c48a86c3553a63ebb3924bea8d46
Author: jao <jao@gnu.org>
Date:   Sun Sep 28 00:24:15 2014 +0200

Upgrade to libmpd 0.9

--- src/Plugins/Monitors/MPD.hs.orig	Mon Sep 29 11:59:33 2014
+++ src/Plugins/Monitors/MPD.hs	Mon Sep 29 12:02:26 2014
@@ -15,6 +15,7 @@
 module Plugins.Monitors.MPD ( mpdConfig, runMPD, mpdWait, mpdReady ) where
 
 import Data.List
+import Data.Maybe (fromMaybe)
 import Plugins.Monitors.Common
 import System.Console.GetOpt
 import qualified Network.MPD as M
@@ -71,7 +72,7 @@ mpdReady _ = do
     -- Only cases where MPD isn't responding is an issue; bogus information at
     -- least won't hold xmobar up.
     Left M.NoMPD    -> return False
-    Left M.TimedOut -> return False
+    Left (M.ConnectionError _) -> return False
     Left _          -> return True
 
 mopts :: [String] -> IO MOpts
@@ -91,8 +92,8 @@ parseMPD (Right st) song opts = do
   where s = M.stState st
         ss = show s
         si = stateGlyph s opts
-        vol = int2str $ M.stVolume st
-        (p, t) = M.stTime st
+        vol = int2str $ fromMaybe 0 (M.stVolume st)
+        (p, t) = fromMaybe (0, 0) (M.stTime st)
         [lap, len, remain] = map showTime [floor p, t, max 0 (t - floor p)]
         b = if t > 0 then realToFrac $ p / fromIntegral t else 0
         plen = int2str $ M.stPlaylistLength st
