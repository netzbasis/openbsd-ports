$OpenBSD: patch-configure,v 1.18 2014/09/02 09:24:44 chrisz Exp $
--- configure.orig	Sun Aug 31 21:04:23 2014
+++ configure	Sun Aug 31 21:06:35 2014
@@ -816,6 +816,8 @@ case "$target" in
                                 if $arch64;then model=ppc64;else model=ppc;fi;;
   armv6*-*-linux-gnueabihf)     arch=arm; model=armv6; system=linux_eabihf;;
   arm*-*-linux-gnueabihf)       arch=arm; system=linux_eabihf;;
+  arm*-*-openbsd*)              arch=arm; system=bsd;;
+  zaurus*-*-openbsd*)           arch=arm; system=bsd;;
   armv7*-*-linux-gnueabi)       arch=arm; model=armv7; system=linux_eabi;;
   armv6t2*-*-linux-gnueabi)     arch=arm; model=armv6t2; system=linux_eabi;;
   armv6*-*-linux-gnueabi)       arch=arm; model=armv6; system=linux_eabi;;
@@ -1324,7 +1326,8 @@ fi
 # Determine if system stack overflows can be detected
 
 case "$arch,$system" in
-  i386,linux_elf|amd64,linux|power,rhapsody|amd64,macosx|i386,macosx)
+  i386,linux_elf|amd64,linux|power,rhapsody|amd64,macosx|i386,macosx| \
+  amd64,openbsd|i386,bsd_elf)
     inf "System stack overflow can be detected."
     echo "#define HAS_STACK_OVERFLOW_DETECTION" >> s.h;;
   *)
@@ -1581,11 +1584,11 @@ echo "X11_LINK=$x11_link" >> Makefile
 
 # Look for BFD library
 
-if ./hasgot -i bfd.h && \
-   ./hasgot -lbfd -ldl -liberty -lz bfd_openr; then
+if ./hasgot -I${OPENBSD_LOCALBASE}/include -DPACKAGE=ocaml -i bfd.h && \
+   ./hasgot -L${OPENBSD_LOCALBASE}/lib -DPACKAGE=ocaml -lbfd -liberty -lz bfd_openr; then
   inf "BFD library found."
   echo "#define HAS_LIBBFD" >> s.h
-  echo "LIBBFD_LINK=-lbfd -ldl -liberty -lz" >> Makefile
+  echo "LIBBFD_LINK=-I${OPENBSD_LOCALBASE}/include -L${OPENBSD_LOCALBASE}/lib -lbfd -liberty -lz" >> Makefile
 else
   wrn "BFD library not found, 'objinfo' will be unable to display info on .cmxs files."
   echo "LIBBFD_LINK=" >> Makefile
