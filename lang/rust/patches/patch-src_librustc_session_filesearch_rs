$OpenBSD: patch-src_librustc_session_filesearch_rs,v 1.2 2016/05/29 07:26:46 semarie Exp $
fallback to CFG_PREFIX as default sysroot.
--- src/librustc/session/filesearch.rs.orig	Mon May 23 18:29:00 2016
+++ src/librustc/session/filesearch.rs	Tue May 24 06:08:20 2016
@@ -162,7 +162,10 @@ pub fn get_or_default_sysroot() -> PathBuf {
 
     match canonicalize(env::current_exe().ok()) {
         Some(mut p) => { p.pop(); p.pop(); p }
-        None => bug!("can't determine value for sysroot")
+        None => match option_env!("CFG_PREFIX") {
+            Some(dir) => PathBuf::from(dir),
+            None => bug!("can't determine value for sysroot"),
+        }
     }
 }
 
