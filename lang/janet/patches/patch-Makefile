$OpenBSD: patch-Makefile,v 1.3 2019/05/14 23:43:31 jturner Exp $

Use a date stamp for JANET_BUILD to avoid using git.
Replace hardcoded -O2.
Fix installation.

Index: Makefile
--- Makefile.orig
+++ Makefile
@@ -27,15 +27,15 @@ PREFIX?=/usr/local
 INCLUDEDIR=$(PREFIX)/include
 BINDIR=$(PREFIX)/bin
 LIBDIR=$(PREFIX)/lib
-JANET_BUILD?="\"$(shell git log --pretty=format:'%h' -n 1)\""
+JANET_BUILD?="\"$(shell date +%Y%m%d)\""
 CLIBS=-lm
 JANET_TARGET=build/janet
 JANET_LIBRARY=build/libjanet.so
 JANET_PATH?=$(PREFIX)/lib/janet
-MANPATH?=$(PREFIX)/share/man/man1/
+MANPATH?=$(PREFIX)/man/man1/
 DEBUGGER=gdb
 
-CFLAGS=-std=c99 -Wall -Wextra -Isrc/include -fpic -O2 -fvisibility=hidden \
+CFLAGS=-std=c99 -Wall -Wextra -Isrc/include -fpic $(FLAGS) -fvisibility=hidden \
 	   -DJANET_BUILD=$(JANET_BUILD)
 LDFLAGS=-rdynamic
 
@@ -282,19 +282,16 @@ install: $(JANET_TARGET) build/version.txt
 	mkdir -p $(INCLUDEDIR)
 	cp $(JANET_HEADERS) $(INCLUDEDIR)
 	mkdir -p $(LIBDIR)
-	cp $(JANET_LIBRARY) $(LIBDIR)/libjanet.so.$(shell cat build/version.txt)
-	ln -sf $(SONAME) $(LIBDIR)/libjanet.so
-	ln -sf libjanet.so.$(shell cat build/version.txt) $(LIBDIR)/$(SONAME)
+	cp $(JANET_LIBRARY) $(LIBDIR)
 	mkdir -p $(INCLUDEDIR)/janet
 	mkdir -p $(JANET_PATH)
-	ln -sf $(INCLUDEDIR)/janet.h $(JANET_PATH)/janet.h
-	ln -sf $(INCLUDEDIR)/janetconf.h $(JANET_PATH)/janetconf.h
+	cp $(INCLUDEDIR)/janet.h $(JANET_PATH)/janet.h
+	cp $(INCLUDEDIR)/janetconf.h $(JANET_PATH)/janetconf.h
 	cp tools/cook.janet $(JANET_PATH)
 	cp tools/highlight.janet $(JANET_PATH)
 	cp tools/bars.janet $(JANET_PATH)
 	mkdir -p $(MANPATH)
 	cp janet.1 $(MANPATH)
-	-ldconfig $(LIBDIR)
 
 test-install:
 	cd test/install && rm -rf build && janet build && janet build
