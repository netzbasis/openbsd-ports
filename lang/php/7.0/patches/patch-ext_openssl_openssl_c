$OpenBSD: patch-ext_openssl_openssl_c,v 1.1 2018/02/16 12:37:23 sthen Exp $

Index: ext/openssl/openssl.c
--- ext/openssl/openssl.c.orig
+++ ext/openssl/openssl.c
@@ -653,32 +653,33 @@ int DSA_set0_key(DSA *d, BIGNUM *pub_key, BIGNUM *priv
 	return 1;
 }
 
+#if !defined (LIBRESSL_VERSION_NUMBER) || LIBRESSL_VERSION_NUMBER < 0x2070000fL
 static const unsigned char *ASN1_STRING_get0_data(const ASN1_STRING *asn1)
 {
 	return M_ASN1_STRING_data(asn1);
 }
+#endif
 
-#if OPENSSL_VERSION_NUMBER < 0x10002000L || defined (LIBRESSL_VERSION_NUMBER)
-
+#if OPENSSL_VERSION_NUMBER < 0x10002000L || \
+	(defined (LIBRESSL_VERSION_NUMBER) && LIBRESSL_VERSION_NUMBER < 0x2070000fL)
 static int X509_get_signature_nid(const X509 *x)
 {
 	return OBJ_obj2nid(x->sig_alg->algorithm);
 }
+#endif
 
 #if OPENSSL_VERSION_NUMBER < 0x10000000L
-
 int EVP_PKEY_id(const EVP_PKEY *pkey)
 {
 	return pkey->type;
 }
+#endif
 
+#if OPENSSL_VERSION_NUMBER < 0x10000000L
 int EVP_PKEY_base_id(const EVP_PKEY *pkey)
 {
 	return EVP_PKEY_type(pkey->type);
 }
-
-#endif
-
 #endif
 
 #endif
