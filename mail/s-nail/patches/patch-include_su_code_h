$OpenBSD: patch-include_su_code_h,v 1.1 2019/12/31 22:50:05 sthen Exp $

commit 0eb2314c
Author:     Steffen Nurpmeso <steffen@sdaoden.eu>
AuthorDate: 2019-12-31 20:34:34 +0100
Commit:     Steffen Nurpmeso <steffen@sdaoden.eu>
CommitDate: 2019-12-31 20:34:52 +0100

    FIX clang: not inlining with <-O2; comment out _Alignof() usage
---
 include/su/code.h | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/include/su/code.h b/include/su/code.h
index 6e6cd74c..af1e5a30 100644
--- include/su/code.h
+++ include/su/code.h
@@ -470,8 +470,9 @@ do{\
 #    define su_INLINE static inline
 #    define su_SINLINE static inline
 #   else
-#    define su_INLINE inline
-#    define su_SINLINE static inline
+     /* clang does not like inline with <-O2 */
+#    define su_INLINE inline __attribute__((always_inline))
+#    define su_SINLINE static inline __attribute__((always_inline))
 #   endif
 #  else
 #   define su_INLINE static __inline
@@ -534,7 +535,8 @@ do{\
 #define su_ROUND_UP2(X,BASE) (((X) + ((BASE) - 1)) & (~((BASE) - 1)))
 
 /* Alignment.  Note: su_uz POW2 asserted in POD section below! */
-#if defined __STDC_VERSION__ && __STDC_VERSION__ +0 >= 201112L
+/* Commented out: "_Alignof() applied to an expression is a GNU extension" */
+#if 0 && defined __STDC_VERSION__ && __STDC_VERSION__ +0 >= 201112L
 # include <stdalign.h>
 # define su_ALIGNOF(X) _Alignof(X)
 #else
