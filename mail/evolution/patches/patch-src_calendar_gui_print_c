$OpenBSD: patch-src_calendar_gui_print_c,v 1.1 2018/06/23 09:56:17 ajacoutot Exp $

From a87ce36cdaaf59ca808e5836ba8d87fb8bef955c Mon Sep 17 00:00:00 2001
From: Milan Crha <mcrha@redhat.com>
Date: Thu, 14 Jun 2018 14:28:37 +0200
Subject: [PATCH] Bug 796174 - strcat() considered unsafe for buffer overflow

Index: src/calendar/gui/print.c
--- src/calendar/gui/print.c.orig
+++ src/calendar/gui/print.c
@@ -3200,8 +3200,10 @@ write_label_piece (time_t t,
 
 	convert_timet_to_struct_tm (t, zone, &tmp_tm);
 
-	if (stext != NULL)
-		strcat (buffer, stext);
+	if (stext != NULL) {
+		len = strlen (buffer);
+		g_snprintf (buffer + len, size - len, "%s", stext);
+	}
 
 	len = strlen (buffer);
 	if (start_cmp && same_date (tmp_tm, *start_cmp, zone))
@@ -3212,8 +3214,11 @@ write_label_piece (time_t t,
 		e_time_format_date_and_time (
 			&tmp_tm, use_24_hour_format, FALSE,
 			FALSE, &buffer[len], size - len);
-	if (etext != NULL)
-		strcat (buffer, etext);
+
+	if (etext != NULL) {
+		len = strlen (buffer);
+		g_snprintf (buffer + len, size - len, "%s", etext);
+	}
 }
 
 static icaltimezone *
