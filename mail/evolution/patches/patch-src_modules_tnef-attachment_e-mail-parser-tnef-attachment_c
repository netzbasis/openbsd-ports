$OpenBSD: patch-src_modules_tnef-attachment_e-mail-parser-tnef-attachment_c,v 1.1 2018/06/23 09:56:17 ajacoutot Exp $

From a87ce36cdaaf59ca808e5836ba8d87fb8bef955c Mon Sep 17 00:00:00 2001
From: Milan Crha <mcrha@redhat.com>
Date: Thu, 14 Jun 2018 14:28:37 +0200
Subject: [PATCH] Bug 796174 - strcat() considered unsafe for buffer overflow

Index: src/modules/tnef-attachment/e-mail-parser-tnef-attachment.c
--- src/modules/tnef-attachment/e-mail-parser-tnef-attachment.c.orig
+++ src/modules/tnef-attachment/e-mail-parser-tnef-attachment.c
@@ -824,29 +824,16 @@ static gchar * getRruleDayname (guchar a) {
 
     *daystring = 0;
 
-    if (a & 0x01) {
-        strcat (daystring, "SU,");
-    }
-    if (a & 0x02) {
-        strcat (daystring, "MO,");
-    }
-    if (a & 0x04) {
-        strcat (daystring, "TU,");
-    }
-    if (a & 0x08) {
-        strcat (daystring, "WE,");
-    }
-    if (a & 0x10) {
-        strcat (daystring, "TH,");
-    }
-    if (a & 0x20) {
-        strcat (daystring, "FR,");
-    }
-    if (a & 0x40) {
-        strcat (daystring, "SA,");
-    }
+    g_snprintf (daystring, sizeof (daystring), "%s%s%s%s%s%s%s",
+	(a & 0x01) ? "SU," : "",
+	(a & 0x02) ? "MO," : "",
+	(a & 0x04) ? "TU," : "",
+	(a & 0x08) ? "WE," : "",
+	(a & 0x10) ? "TH," : "",
+	(a & 0x20) ? "FR," : "",
+	(a & 0x40) ? "SA," : "");
 
-    if (strlen (daystring)) {
+    if (*daystring) {
         daystring[strlen (daystring) - 1] = 0;
     }
 
