$OpenBSD: patch-configure_ac,v 1.3 2017/12/26 19:17:11 robert Exp $

Index: configure.ac
--- configure.ac.orig
+++ configure.ac
@@ -54,11 +54,13 @@ case "$host_os" in
 	openbsd*)
 		BUILDOS="openbsd"
 		ZCPPFLAGS="$ZCPPFLAGS -DOPENBSD"
+		TINFO_LIB=""
 		LN_TFSV="ln -fs"
 		;;
 	linux*)
 		BUILDOS="linux"
 		ZCPPFLAGS="$ZCPPFLAGS -DLINUX"
+		TINFO_LIB="-ltinfo"
 		LN_TFSV="ln -Tfsv"
 		;;
 esac
@@ -76,6 +78,7 @@ AC_SUBST([ZPHPCXXFLAGS])
 ZCPPFLAGS="$ZCPPFLAGS \
 	-I\${top_builddir}/common/include \
 	-I\${top_srcdir}/common/include \
+	-I\${top_srcdir}/mapi4linux/include \
 	-I\${top_srcdir}/m4lcommon/include \
 	-I\${top_srcdir}/provider/common/include \
 	-I\${top_srcdir}/provider/libserver/include \
@@ -253,7 +256,7 @@ AC_DEFUN([LIBNCURSES_WITH_CONFIG],[
 		[
 			dnl just pick the lowest common denominator
 			NCURSES_FLAGS=""
-			NCURSES_LIBS="-lncurses -ltinfo"
+			NCURSES_LIBS="-lncurses ${TINFO_LIB}"
 		]
 	)
 	dnl We should be using ncurses.h - or is portability to non-ncurses
@@ -500,7 +503,7 @@ AC_SEARCH_LIBS([crypt_r], [crypt], [
 ])
 LIBS="$LIBS_system"
 AC_SEARCH_LIBS([clock_gettime], [rt], [
-	AS_IF([test "$LIBS" = "$LIBS_system"], [clock_LIBS=""], [clock_LIBS="-lrt"])
+	AS_IF([test "$LIBS" = "$LIBS_system"], [clock_LIBS=""], [clock_LIBS=""])
 ])
 LIBS="$LIBS_system"
 AC_SUBST([CRYPT_LIBS])
@@ -677,6 +680,8 @@ ZCPPFLAGS="$ZCPPFLAGS $icu_uc_CFLAGS $icu_i18n_CFLAGS"
 # all libs for programs, because functions are in static common stuff
 PROG_LIBS="$UUID_LIBS $INTL_LIBS $ICONV_LIBS $GZ_LIBS"
 AC_SUBST(PROG_LIBS)
+
+AC_CHECK_FUNCS([arc4random_buf])
 
 # done testing C++ requirements
 AC_LANG_POP
